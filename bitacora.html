<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>BitÃ¡cora - GeoChile Monitor</title>
    <style>
        body { font-family: sans-serif; padding: 20px; background: #f4f4f4; }
        .container { max-width: 900px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; }
        h2 { border-bottom: 2px solid #D32F2F; color: #333; }
        table { width: 100%; border-collapse: collapse; margin-bottom: 20px; font-size: 0.9rem; }
        th { background: #333; color: white; padding: 10px; }
        td { border: 1px solid #ddd; padding: 8px; text-align: center; }
        .btn-volver { display: inline-block; padding: 10px 20px; background: #555; color: white; text-decoration: none; border-radius: 5px; }
    </style>
</head>
<body>
    <div class="container">
        <a href="index.html" class="btn-volver">â¬… Volver al Mapa</a>
        <h1>ðŸ“‹ BitÃ¡cora de Datos</h1>

        <h2>ðŸŒŠ Datos FÃ­sicos (Ãšltimos 20)</h2>
        <table>
            <thead><tr><th>Fecha</th><th>Temp (Â°C)</th><th>Salinidad</th><th>Corriente U (m/s)</th><th>Corriente V (m/s)</th><th>Nivel Mar</th></tr></thead>
            <tbody id="tabla-fisicos"><tr><td colspan="5">Cargando...</td></tr></tbody>
        </table>

        <h2>ðŸŒ¿ Datos BiolÃ³gicos (Ãšltimos 20)</h2>
        <table>
            <thead><tr><th>Fecha</th><th>Clorofila</th><th>OxÃ­geno</th></tr></thead>
            <tbody id="tabla-bio"><tr><td colspan="3">Cargando...</td></tr></tbody>
        </table>
    </div>

    <script>
        const API_URL = ''; 
        
        fetch(`${API_URL}/api/v1/bitacora-completa`)
            .then(res => {
                if (!res.ok) throw new Error("Error del servidor (404 o 500)");
                return res.json();
            })
            .then(data => {
                // CORRECCIÃ“N 1: Usamos el ID correcto 'tabla-fisicos'
                const tFis = document.getElementById('tabla-fisicos');
                tFis.innerHTML = '';
                
                // Verificamos si hay datos antes de recorrer
                if(data.fisicos && data.fisicos.length > 0) {
                    data.fisicos.forEach(d => {
                        // CORRECCIÃ“N 2: Aseguramos que existan valores para evitar errores
                        tFis.innerHTML += `<tr>
                            <td>${d.fecha_medicion}</td>
                            <td>${d.temperatura}</td>
                            <td>${d.salinidad}</td>
                            <td>${d.corriente_u}</td>
                            <td>${d.corriente_v}</td>
                            <td>${d.nivel_mar}</td>
                        </tr>`;
                    });
                } else {
                    tFis.innerHTML = '<tr><td colspan="6">No hay datos registrados</td></tr>';
                }

                // CORRECCIÃ“N 3: Usamos el ID correcto 'tabla-bio'
                const tBio = document.getElementById('tabla-bio');
                tBio.innerHTML = '';

                if(data.biologicos && data.biologicos.length > 0) {
                    data.biologicos.forEach(d => {
                        tBio.innerHTML += `<tr>
                            <td>${d.fecha_medicion}</td>
                            <td>${d.clorofila}</td>
                            <td>${d.oxigeno_disuelto}</td>
                        </tr>`;
                    });
                } else {
                    tBio.innerHTML = '<tr><td colspan="3">No hay datos registrados</td></tr>';
                }
            })
            .catch(err => {
                console.error(err);
                alert("Error cargando bitÃ¡cora. Revisa la consola (F12).");
            });
    </script>
</body>
</html>