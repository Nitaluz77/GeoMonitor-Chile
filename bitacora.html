<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>BitÃ¡cora CientÃ­fica - GeoMonitor</title>
    <link href="https://fonts.googleapis.com/css2?family=ADLaM+Display&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="static/css/style.css">
    <style>
        body { background-color: #f4f6f8; font-family: 'Segoe UI', sans-serif; }
        .contenedor { max-width: 1200px; margin: 20px auto; padding: 20px; }
        
        .header-bitacora { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .btn-volver { background: #333; color: white; padding: 8px 20px; border-radius: 20px; text-decoration: none; font-weight: bold; }
        .btn-volver:hover { background: #D32F2F; }

        .seccion-tabla { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 30px; }
        .titulo-tabla { font-size: 1.2rem; color: #0277BD; border-bottom: 2px solid #eee; padding-bottom: 10px; margin-bottom: 15px; font-weight: bold; display: flex; align-items: center; gap: 10px; }
        
        table { width: 100%; border-collapse: collapse; font-size: 0.9rem; }
        th { background: #ECEFF1; color: #333; padding: 12px; text-align: left; font-weight: bold; border-bottom: 2px solid #ddd; }
        td { padding: 10px 12px; border-bottom: 1px solid #eee; }
        tr:hover { background: #f9f9f9; }

        .vacio { text-align: center; color: #999; padding: 20px; font-style: italic; }
    </style>
</head>
<body>

    <header>
        <div class="logo"><span style="border-bottom: 3px solid #D32F2F;">Geo</span>Monitor</div>
        <div style="font-weight: bold; color: #555;">ðŸ“‚ BASE DE DATOS UNIFICADA</div>
    </header>

    <div class="contenedor">
        <div class="header-bitacora">
            <a href="index.html" class="btn-volver">â¬… Volver al Mapa</a>
            <span style="color: #666; font-size: 0.9rem;">Mostrando Ãºltimos 30 registros por tabla</span>
        </div>

        <div class="seccion-tabla">
            <div class="titulo-tabla">
                ðŸŒŠ Tabla: datos_fisicos (Variables OceanogrÃ¡ficas)
            </div>
            <table>
                <thead>
                    <tr>
                        <th>Fecha Registro</th>
                        <th>Temperatura</th>
                        <th>Salinidad</th>
                        <th>Corrientes (U / V)</th>
                        <th>Nivel Mar</th>
                    </tr>
                </thead>
                <tbody id="body-fisicos">
                    <tr><td colspan="5" class="vacio">Cargando datos...</td></tr>
                </tbody>
            </table>
        </div>

        <div class="seccion-tabla">
            <div class="titulo-tabla">
                ðŸŒ¿ Tabla: datos_bio (Calidad de Agua)
            </div>
            <table>
                <thead>
                    <tr>
                        <th>Fecha Registro</th>
                        <th>Clorofila-a (mg/mÂ³)</th>
                        <th>OxÃ­geno Disuelto (mmol/L)</th>
                        <th>Estado</th>
                    </tr>
                </thead>
                <tbody id="body-biologicos">
                    <tr><td colspan="4" class="vacio">Cargando datos...</td></tr>
                </tbody>
            </table>
        </div>
    </div>

    <script>
        const API_URL = 'http://localhost:3000';

        fetch(`${API_URL}/api/v1/bitacora-completa`)
            .then(res => res.json())
            .then(data => {
                llenarTabla('body-fisicos', data.fisicos, 'fisico');
                llenarTabla('body-biologicos', data.biologicos, 'bio');
            })
            .catch(err => console.error("Error:", err));

        function llenarTabla(idBody, datos, tipo) {
            const tbody = document.getElementById(idBody);
            tbody.innerHTML = '';

            if (datos.length === 0) {
                tbody.innerHTML = `<tr><td colspan="5" class="vacio">La tabla estÃ¡ vacÃ­a.</td></tr>`;
                return;
            }

            datos.forEach(d => {
                const fecha = new Date(d.fecha).toLocaleString('es-CL');
                const fmt = (n) => (n !== null) ? parseFloat(n).toFixed(2) : '--';
                let html = '';

                if (tipo === 'fisico') {
                    html = `
                        <tr>
                            <td>${fecha}</td>
                            <td><b>${fmt(d.temp)} Â°C</b></td>
                            <td>${fmt(d.salinidad)} PSU</td>
                            <td>U: ${fmt(d.u)} | V: ${fmt(d.v)}</td>
                            <td>${fmt(d.nivel_mar)} m</td>
                        </tr>`;
                } else {
                    // LÃ³gica visual para biologÃ­a
                    let estado = 'Normal';
                    if (d.oxigeno < 4) estado = '<span style="color:red; font-weight:bold;">Hipoxia</span>';
                    else estado = '<span style="color:green;">Ã“ptimo</span>';

                    html = `
                        <tr>
                            <td>${fecha}</td>
                            <td>${fmt(d.clorofila)}</td>
                            <td>${fmt(d.oxigeno)}</td>
                            <td>${estado}</td>
                        </tr>`;
                }
                tbody.innerHTML += html;
            });
        }
    </script>

</body>
</html>